<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Travel Itinerary</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .input-section, .itinerary-section, .share-section, .controls-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        h2 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        label {
            display: inline-block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="datetime-local"] {
            width: calc(100% - 22px); /* Adjust for padding and border */
            padding: 8px 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            margin-right: 10px; /* Space between buttons */
        }
        button:hover {
            background-color: #0056b3;
        }
        #itinerary-list {
            list-style-type: none;
            padding: 0;
        }
        #itinerary-list li {
            background-color: #fff;
            padding: 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 5px;
            border-radius: 3px;
        }
        #itinerary-list li:last-child {
            border-bottom: none;
        }

        /* Responsive adjustments */
        @media screen and (max-width: 600px) {
            body {
                font-size: 14px;
                margin: 10px;
            }
            .input-section, .itinerary-section, .share-section, .controls-section {
                padding: 10px;
            }
            input[type="text"], input[type="datetime-local"], button {
                width: 100%; /* Full width for inputs and buttons on small screens */
                margin-bottom: 10px;
            }
            button {
                margin-right: 0; /* Remove right margin for stacked buttons */
            }
        }
    </style>
</head>
<body>
    <h1>My Travel Itinerary Planner</h1>

    <div class="input-section">
        <h2>Add New Location</h2>
        <label for="location">Location:</label>
        <input type="text" id="location" name="location" placeholder="e.g., Eiffel Tower"><br>

        <label for="start-time">Estimated Start:</label>
        <input type="datetime-local" id="start-time" name="start-time"><br>

        <label for="end-time">Estimated End:</label>
        <input type="datetime-local" id="end-time" name="end-time"><br>

        <button onclick="addLocation()">Add to Itinerary</button>
    </div>

    <div class="itinerary-section">
        <h2>My Travel Itinerary</h2>
        <ul id="itinerary-list" aria-live="polite">
            </ul>
    </div>

    <div class="controls-section">
        <h2>Manage Itinerary</h2>
        <button onclick="saveItinerary()">Save Itinerary</button>
        <button onclick="generateShareLink()">Generate Shareable Link</button>
    </div>

    <div class="share-section">
        <h2>Share Your Plans</h2>
        <p>Click "Generate Shareable Link" above to get a link you can send to others. They will see the itinerary as it was when you generated the link.</p>
    </div>

    <script>
        // --- Date/Time Validation ---
        function validateDateTime(dateTimeString) {
            // For datetime-local, the browser handles format validation mostly.
            // We just need to ensure it's not empty.
            // More complex validation (e.g., end time after start time) could be added.
            return dateTimeString !== ""; 
        }

        // --- Add Location to Itinerary ---
        function addLocation() {
            const locationInput = document.getElementById('location');
            const startTimeInput = document.getElementById('start-time');
            const endTimeInput = document.getElementById('end-time');
            const itineraryList = document.getElementById('itinerary-list');

            const location = locationInput.value.trim();
            const startTime = startTimeInput.value; // datetime-local gives value in YYYY-MM-DDTHH:mm
            const endTime = endTimeInput.value;

            if (!location) {
                alert('Please enter a location.');
                return;
            }
            // Basic check, browser input type="datetime-local" handles format.
            if (!startTime || !endTime) { 
                alert('Please enter both a start and end date/time.');
                return;
            }
            // Optional: More complex validation like start time before end time
            if (new Date(startTime) >= new Date(endTime)) {
                alert('End time must be after start time.');
                return;
            }


            const listItem = document.createElement('li');
            // Format date/time for display if needed, or use as is
            const formattedStartTime = startTime.replace('T', ' ');
            const formattedEndTime = endTime.replace('T', ' ');
            listItem.textContent = `${location} (From: ${formattedStartTime} To: ${formattedEndTime})`;
            itineraryList.appendChild(listItem);

            // Clear input fields after adding
            locationInput.value = '';
            startTimeInput.value = '';
            endTimeInput.value = '';
        }

        // --- Save Itinerary to Local Storage ---
        function saveItinerary() {
            const itineraryList = document.getElementById('itinerary-list');
            const items = itineraryList.getElementsByTagName('li');
            const itineraryData = [];

            for (let item of items) {
                itineraryData.push(item.textContent); // Storing the displayed text
            }

            if (itineraryData.length > 0) {
                localStorage.setItem('itinerary', JSON.stringify(itineraryData));
                alert('Itinerary saved locally!');
            } else {
                alert('Nothing to save.');
            }
        }

        // --- Load Itinerary from Local Storage ---
        function loadItinerary() {
            const savedItinerary = localStorage.getItem('itinerary');
            if (savedItinerary) {
                const itineraryList = document.getElementById('itinerary-list');
                const itineraryData = JSON.parse(savedItinerary);

                itineraryData.forEach(itemText => {
                    const listItem = document.createElement('li');
                    listItem.textContent = itemText;
                    itineraryList.appendChild(listItem);
                });
            }
        }
        
        // --- Generate Shareable Link ---
        function generateShareLink() {
            const itineraryList = document.getElementById('itinerary-list');
            const items = itineraryList.getElementsByTagName('li');
            const itineraryData = [];

            for (let item of items) {
                itineraryData.push(item.textContent); // Storing the displayed text
            }

            if (itineraryData.length > 0) {
                // Construct the URL with itinerary data as a query parameter
                const shareableLink = `${window.location.origin}${window.location.pathname}?itinerary=${encodeURIComponent(JSON.stringify(itineraryData))}`;
                
                // Prompt user with the link (could also copy to clipboard or display in a read-only input)
                prompt("Copy this link to share your itinerary:", shareableLink);
            } else {
                alert('Your itinerary is empty. Add some locations first!');
            }
        }

        // --- Load Itinerary and Parse URL on Page Load ---
        window.onload = function() {
            loadItinerary(); // Load from local storage first

            // Check if itinerary data is present in the URL
            const urlParams = new URLSearchParams(window.location.search);
            const itineraryParam = urlParams.get('itinerary');

            if (itineraryParam) {
                try {
                    const itineraryDataFromLink = JSON.parse(decodeURIComponent(itineraryParam));
                    const itineraryList = document.getElementById('itinerary-list');
                    itineraryList.innerHTML = ''; // Clear existing list if loading from link

                    itineraryDataFromLink.forEach(itemText => {
                        const listItem = document.createElement('li');
                        listItem.textContent = itemText;
                        itineraryList.appendChild(listItem);
                    });
                    alert('Itinerary loaded from shared link!');
                } catch (e) {
                    console.error("Error parsing itinerary data from URL:", e);
                    alert("Could not load itinerary from the link. The link might be corrupted.");
                }
            }
        };
    </script>
</body>
</html>
